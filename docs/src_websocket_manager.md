# WebSocket Manager

**Module:** `src.websocket_manager`  
**File:** `src/websocket_manager.py`

## Overview

WebSocket Management Module for Presentator

This module provides the WebSocketManager class which handles real-time
communication between the server and connected clients (viewers and controllers).
Manages connection state, broadcasting, and message handling for synchronized
slideshow control across multiple devices.

## Classes

### WebSocketManager

Manages WebSocket connections and real-time state broadcasting.

Handles all WebSocket communication for the Presentator system, including
client connection management, state synchronization, and message broadcasting
to all connected viewers and controllers.

Attributes:
    clients (set): Set of active WebSocket connections
    current_state (dict): Current system state including:
        - current_slideshow: Active slideshow data
        - current_slide: Current slide index
        - slideshows: List of available slideshows
        - playing: Playback status

#### Methods

**`__init__(self)`**

Initialize the WebSocketManager.

Sets up empty client set and initial state with no active slideshow.

**`broadcast_slideshows_list(self)`**

Broadcast updated slideshows list to all connected clients.

Sends the current list of available slideshows to all connected clients.
Used when slideshows are added, removed, or modified to keep all
interfaces synchronized.

Note:
    Only broadcasts if there are connected clients.
    Handles connection errors by removing failed connections.

**`broadcast_state(self)`**

Broadcast current state to all connected clients.

Sends the current system state (slideshow, slide index, playback status)
to all connected WebSocket clients. Automatically removes disconnected
clients from the client set.

Note:
    Creates a copy of clients set to avoid modification during iteration.
    Handles connection errors gracefully by removing failed connections.

**`get_current_state(self)`**

Get the current application state.

Returns a copy of the current system state to prevent external
modification of internal state.

Returns:
    dict: Copy of current state containing slideshow and playback information

**`handle_client(self, websocket)`**

Handle new WebSocket client connections.

Manages the lifecycle of a WebSocket client connection, including:
- Adding client to active connections set
- Sending initial state to new client
- Processing incoming messages and commands
- Cleaning up on disconnection

Args:
    websocket: WebSocket connection object
    
Note:
    This method runs for the duration of the client connection.
    Automatically removes client from set when connection closes.

**`handle_command(self, command, params)`**

Handle WebSocket commands from clients.

Processes commands received from connected clients and updates system
state accordingly. Broadcasts state changes to all connected clients.

Supported commands:
    - refresh_slideshows: Reload slideshow list
    - load_slideshow: Load specific slideshow by ID
    - set_slide: Navigate to specific slide
    - play: Start slideshow playback
    - pause: Pause slideshow playback
    - stop: Stop slideshow and reset
    
Args:
    command (str): Command name
    params (dict): Command parameters

**`start_websocket_server(self, port=50001)`**

Start the WebSocket server.

Creates and starts the WebSocket server on the specified port,
listening on all network interfaces.

Args:
    port (int): Port number to listen on (default: 50001)
    
Returns:
    Server object from websockets.serve()
    
Note:
    This method starts the server but doesn't block. Use with asyncio.run()
    or similar to run the server.

**`update_slideshows_list(self, slideshows)`**

Update the global slideshows list.

Updates the internal state with a new list of available slideshows.
This method is called when slideshows are discovered, added, or removed.

Args:
    slideshows (list): List of slideshow dictionaries


## Functions

### broadcast_slideshows_list()

No documentation available.

### broadcast_state()

No documentation available.

### get_current_state()

No documentation available.

### get_default_manager()

No documentation available.

### handle_client(websocket)

No documentation available.

### handle_command(command, params)

No documentation available.

### start_websocket_server(port=50001)

No documentation available.

### update_slideshows_list(slideshows)

No documentation available.

## Source File Statistics

- **Total Lines:** 321
- **Code Lines:** 249
- **Functions:** 6
- **Classes:** 1
- **File Size:** 11944 bytes


---
*Generated by Presentator documentation generator*
